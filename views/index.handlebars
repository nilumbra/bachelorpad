<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/agency.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <script src="javascripts/howler.min.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="//js.leapmotion.com/leap-0.6.4.js"></script>
    <script src="//js.leapmotion.com/leap-plugins-0.1.8.js"></script>

    <!-- Google -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>


    <!-- Load c3.css -->
    <link href="css/c3.min.css" rel="stylesheet" type="text/css">

    <!-- Load d3.js and c3.js-->
    <script src="js/d3.min.js" charset="utf-8"></script>
    <script src="js/c3.min.js"></script>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">Bachelor Pad</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#item1">About</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#item2">OurTeam</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#item2" onclick="toggleMusic()">Sound</a>
                    </li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="intro-text">
                <div class="intro-lead-in">FIND YOUR IDEAL</div>
                <div class="intro-lead-in">HOUSING</div>
                <div class="intro-lead-in">SIMPLY, ESAILY AND </div>
                <div class="intro-lead-in">BEAUTIFULLY.</div>

                <a href="#services" class="page-scroll btn btn-xl">explore</a>
            </div>
        </div>
    </header>



    <script>

        var ucsd = new google.maps.LatLng(32.880694,-117.236331);
        var NIGHT_MAPTYPE_ID = 'Night Map';
        var DAY_MAPTYPE_ID = 'Day Map';

        var nightSound = new Howl({
            urls: ['sounds/nightlife.ogg', 'sounds/nightlife.m4a'/*, 'sounds/nightlife.mp3'*/],
            autoplay: false,
            loop: true,
            volume: 0.2
        });
        var daySound = new Howl({
            urls: ['sounds/daytime.ogg', 'sounds/daytime.m4a'/*, 'sounds/daytime.mp3'*/],
            autoplay: false,
            loop: true,
            volume: 0.2
        });

        var barIcon = {
            url: 'images/bar_cocktail.png',
            size: new google.maps.Size(32, 37),
            origin: new google.maps.Point(0,0),
            anchor: new google.maps.Point(16, 16)
        };
        var marketIcon = {
            url: 'images/supermarket.png',
            size: new google.maps.Size(32, 37),
            origin: new google.maps.Point(0,0),
            anchor: new google.maps.Point(16, 16)
        };
        var houseIcon = {
            url: 'images/home.png',
            size: new google.maps.Size(32, 37),
            origin: new google.maps.Point(0,0),
            anchor: new google.maps.Point(16, 16)
        };

        var nightMapStyle = [
            {
                stylers: [
                    { hue: "#194C62" },
                    { saturation: -40 },
                    { invert_lightness: true}
                ]
            }
        ];


        var dayMapStyle = [
            {
               /* stylers: [
                    { hue: "#1765C62" },
                    { saturation: -40 },
                    { invert_lightness: true}
                ]*/
            }
        ];

        var testDayStyle = [
            {
                "featureType": "landscape",
                "elementType": "geometry.fill",
                "stylers": [
                    {"lightness": 80},
                    {"gamma": 4.41}
                ]
            }, {
                "elementType": "labels",
                "stylers": [
                    {"visibility": "off"}
                ]
            }, {
                "featureType": "road",
                "stylers": [
                    {"hue": "#2a00ff"},
                    {"saturation": 50},
                    {"lightness": -15}
                ]
            }, {
                "featureType": "road.highway",
                "stylers": [
                    {"hue": "#ff3300"},
                    {"visibility": "off"}
                ]
            }, {}
        ];


        var nightStyledMapOptions = {
            name: 'Night Style'
        };
        var dayStyledMapOptions = {
            name: 'Day Style'
        };

        var boundingCircle;
        var boundingCircleShowing = false;

        var mapOptions = {
            zoom: 12,
            center: ucsd,
            mapTypeControlOptions: {
                mapTypeIds: [
                    DAY_MAPTYPE_ID,
                    NIGHT_MAPTYPE_ID]
            },
            mapTypeId: NIGHT_MAPTYPE_ID
        };

        var nightMapType = new google.maps.StyledMapType(nightMapStyle, nightStyledMapOptions);
        var dayMapType = new google.maps.StyledMapType(testDayStyle, dayStyledMapOptions);


        var placeSearch, autocomplete;
        var map, layer;

        var geocoder;
        var rangeShowing = false;
        var citymap = {};
        var largeCircle;
        var medCircle;
        var smallCircle;

        var largeCircleRadius = (1609.34)*1; //meters
        var medCircleRadius = (1609.34)*.5;
        var smallCircleRadius = (1609.34)*.25;

        var playSound = false;
        var eFunction;

        var dayRequest;
        var service;

        var barMarkerHash = {};
        var storeMarkerHash = {};

        var infowindow;
        function initialize(){




            map = new google.maps.Map(document.getElementById("googleMap"), mapOptions);
            map.mapTypes.set(NIGHT_MAPTYPE_ID, nightMapType);
            map.mapTypes.set(DAY_MAPTYPE_ID, dayMapType);
            map.setMapTypeId(NIGHT_MAPTYPE_ID);
            service = new google.maps.places.PlacesService(map);
            infowindow = new google.maps.InfoWindow();
            geocoder = new google.maps.Geocoder();
            layer = new google.maps.FusionTablesLayer({
                query: {
                    select: 'geometry',
                    from: '1lLm4NeW8qtaO1UYpIgopccaJ_tdOMpsHlquX8g'
                }
            });




            // Try HTML5 geolocation
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = new google.maps.LatLng(position.coords.latitude,
                            position.coords.longitude);

                    /*
                    var infowindow = new google.maps.InfoWindow({
                        map: map,
                        position: pos,
                        content: 'Location found using HTML5.'
                    });*/

                    map.setCenter(pos);
                }, function() {
                    handleNoGeolocation(true);
                });
            } else {
                // Browser doesn't support Geolocation
                handleNoGeolocation(false);
            }





            google.maps.event.addListener(map, 'maptypeid_changed', function() {

                eFunction = Math.pow(Math.E, (22-(map.getZoom())))+2;

                console.log("map has changed to: "+eFunction);
                //daySound.pause();
                //nightSound.pause();

                if(map.getMapTypeId() == DAY_MAPTYPE_ID) {

                    setAllMarkers(barMarkerHash, null)
                    setAllMarkers(storeMarkerHash, map)
                    nightSound.fade(0, 0, 1500, function() {
                        nightSound.pause();
                    });
                    if(playSound)
                        daySound.play();

                    dayRequest = {
                        location: map.getCenter(),
                        radius: eFunction,
                        types: ['grocery_or_supermarket']
                    };

                    service.nearbySearch(dayRequest, function (results, status) {

                        daySound.fade(0, 0.1 * results.length, 500);
                        if (status == google.maps.places.PlacesServiceStatus.OK) {

                            for (var i = 0; i < results.length; i++) {
                                createMarker(results[i], marketIcon);
                            }

                        }
                    });
                }
                else if(map.getMapTypeId() == NIGHT_MAPTYPE_ID) {
                    setAllMarkers(barMarkerHash, map)
                    setAllMarkers(storeMarkerHash, null)
                    daySound.fade(0, 0, 1500, function() {
                        daySound.pause();
                    });
                    if(playSound)
                        nightSound.play();

                    var nightRequest = {
                        location: map.getCenter(),
                        radius: eFunction,
                        types: ['bar', 'night_club']
                    };
                    service.nearbySearch(nightRequest, function (results, status) {
                        nightSound.fade(0, 0.05 * results.length, 500);
                        if (status == google.maps.places.PlacesServiceStatus.OK) {

                            for (var i = 0; i < results.length; i++) {
                                createMarker(results[i], barIcon);
                            }
                        }
                    });
                }

            });




            google.maps.event.addListener(map, 'center_changed', function() {
                var zoom = map.getZoom();
                if(zoom < 16)
                    zoom = 16;

                eFunction = Math.pow(Math.E, ((22-(zoom)))+1);
                //console.log("zoom: "+zoom);

                if(map.getMapTypeId() == DAY_MAPTYPE_ID) { //daytime

                    dayRequest = {
                        location: map.getCenter(),
                        radius: (eFunction),
                        types: ['grocery_or_supermarket']
                    };
                    /*var nearestMall = {
                        location: map.getCenter(),
                        radius: 500,
                        types: ['shopping_mall']
                    };
                    var nearestGym = {
                        location: map.getCenter(),
                        radius: 500,
                        types: ['gym']
                    };*/

                    service.nearbySearch(dayRequest, function (results, status) {

                        if(results != null){
                            daySound.volume(0.05 * results.length, 0.05 * results.length, 1000);
                        }
                        if (status == google.maps.places.PlacesServiceStatus.OK) {

                            for (var i = 0; i < results.length; i++) {
                                createMarker(results[i], marketIcon);
                            }
                        }

                    });
                }
                else { //nighttime

                    var nightRequest = {
                        location: map.getCenter(),
                        radius: eFunction,
                        types: ['bar', 'night_club']
                    };
                    var alcRequest = {
                        location: map.getCenter(),
                        radius: 500,
                        types: ['liquor_store']
                    };
                    service.nearbySearch(nightRequest, function (results, status) {



                        if(results != null){

                            nightSound.volume(0.05 * results.length, 0.05 * results.length, 1000);
                        }

                        if (status == google.maps.places.PlacesServiceStatus.OK) {

                            if (status == google.maps.places.PlacesServiceStatus.OK) {
                                for (var i = 0; i < results.length; i++) {
                                    createMarker(results[i], barIcon);
                                }
                            }
                        }

                    });
                }


                autocomplete = new google.maps.places.Autocomplete(
                        /** @type {HTMLInputElement} */(document.getElementById('autocomplete')),
                        { types: ['geocode'] });
                // When the user selects an address from the dropdown,
                // populate the address fields in the form.
                google.maps.event.addListener(autocomplete, 'place_changed', function() {
                    fillInAddress();
                });


            } );





            google.maps.event.addListener(map, 'click', function(event) {

                var lat = event.latLng.lat();
                var lng = event.latLng.lng();
                geocodePosition(event.latLng);
            });


            //setupMapRegions();
            //getMedianValues();

            initializeMapSoundAndIcons();




        }


        function createMarker(place, icon) {

            //Save the marker to hash for use later
            if(icon == barIcon){
                if(barMarkerHash[place.id] != undefined){
                    return;
                }else{

                    var marker = new google.maps.Marker({
                        map: map,
                        position: place.geometry.location,
                        animation: google.maps.Animation.DROP,
                        icon: icon
                    });

                    barMarkerHash[place.id] = marker;
                }
            }

            else if(icon == marketIcon ){
                if(storeMarkerHash[place.id] != undefined){
                    return;
                }else{
                    var marker = new google.maps.Marker({
                        map: map,
                        position: place.geometry.location,
                        animation: google.maps.Animation.DROP,
                        icon: icon
                    });

                    storeMarkerHash[place.id] = marker;
                }
            }


            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(place.name);
                infowindow.open(map, this);
            });


        }

        google.maps.event.addDomListener(window, 'load', initialize);


        function setAllMarkers(hash, map){
            Object.keys(hash).forEach(function (key) {
                //console.log(hash[key]);
                hash[key].setMap(map);
            })

        }


        function initializeMapSoundAndIcons(){
            //13
            eFunction = Math.pow(Math.E, (22-(map.getZoom())))+2;
            if(map.getMapTypeId() == DAY_MAPTYPE_ID) {

                dayRequest = {
                    location: map.getCenter(),
                    radius: (eFunction),
                    types: ['grocery_or_supermarket']
                };

                service.nearbySearch(dayRequest, function (results, status) {
                    if(playSound)
                        //daySound.fadeIn(0.05 * results.length, 1500);
                        daySound.volume(0.05 * results.length, 0.05 * results.length, 1000);
                    else
                        daySound.volume(0);
                    if (status == google.maps.places.PlacesServiceStatus.OK) {
                        for (var i = 0; i < results.length; i++) {
                            createMarker(results[i], marketIcon);
                        }
                    }
                });
            }
            else { //nighttime

                var nightRequest = {
                    location: map.getCenter(),
                    radius: eFunction,
                    types: ['bar', 'night_club']
                };

                service.nearbySearch(nightRequest, function (results, status) {
                    if(playSound)
                        daySound.volume(0.05 * results.length, 0.05 * results.length, 1000);
                    else
                        daySound.volume(0);
                    if (status == google.maps.places.PlacesServiceStatus.OK) {
                        for (var i = 0; i < results.length; i++) {
                            createMarker(results[i], barIcon);
                        }
                    }

                });
            }
        }


        /**
         * Show bounding Circle
         */
        function toggleBoundingCircle() {


            if (boundingCircle == null) {

                boundingCircle = new google.maps.Circle({
                    editable: true,
                    strokeColor: '#D32F2F',
                    strokeOpacity: 0.18,
                    strokeWeight: 2,
                    fillColor: '#D32F2F',
                    fillOpacity: 0.2,
                    radius: 1000,
                    center: map.getCenter()
                });
            }
            if (boundingCircleShowing){ //Hide

                console.log("CenterLoc:" +boundingCircle.getCenter())
                boundingCircle.setMap(null);
                var showCircleOptions = {
                    editable: false,
                    strokeColor: '#D32F2F',
                    strokeOpacity: 0,
                    fillColor: '#D32F2F',
                    fillOpacity: 0,
                    map: map,
                    center: boundingCircle.getCenter(),
                    radius: boundingCircle.radius
                };

                boundingCircle = new google.maps.Circle(showCircleOptions);
            }
            else{ //Show

                var showCircleOptions = {
                    editable: true,
                    strokeColor: '#D32F2F',
                    strokeOpacity: 0.18,
                    strokeWeight: 2,
                    fillColor: '#D32F2F',
                    fillOpacity: 0.2,
                    map: map,
                    center: boundingCircle.getCenter(),
                    radius: boundingCircle.radius
                };

                boundingCircle = new google.maps.Circle(showCircleOptions);
            }

            boundingCircleShowing = !boundingCircleShowing;
        }


        /**
         * AutoComplete locator
         *
         * */
        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var geolocation = new google.maps.LatLng(
                            position.coords.latitude, position.coords.longitude);
                    var circle = new google.maps.Circle({
                        center: geolocation,
                        radius: position.coords.accuracy
                    });
                    autocomplete.setBounds(circle.getBounds());
                });
            }
        }
        function fillInAddress() {
            // Get the place details from the autocomplete object.
            var place = autocomplete.getPlace();

            console.log("The place: "+JSON.stringify(place));
            /*for (var component in componentForm) {
                document.getElementById(component).value = '';
                document.getElementById(component).disabled = false;
            }

            // Get each component of the address from the place details
            // and fill the corresponding field on the form.
            for (var i = 0; i < place.address_components.length; i++) {
                var addressType = place.address_components[i].types[0];
                if (componentForm[addressType]) {
                    var val = place.address_components[i][componentForm[addressType]];
                    document.getElementById(addressType).value = val;
                }
            }
            */

        }


        function geocodePosition(pos) {
            geocoder.geocode({
                latLng: pos
            }, function(responses) {
                if (responses && responses.length > 0) {
                    //console.log(responses[0].formatted_address); //TODO do some action
                    getZillowId(responses[0].formatted_address);
                } else {
                    console.log('Cannot determine address at this location.'); //TODO give dialog?
                }
            });
        }

        function getZillowId(address) {
            $.ajax({
                type: "GET",
                url: '/getDeepSearchResults',
                data: {address: address},
                success: function(result) {
                    console.log("Success: "+JSON.stringify(result));
                    var latitude = result.results[0].result[0].address[0].latitude[0];
                    var longitude = result.results[0].result[0].address[0].longitude[0];
                    console.log("latitude "+JSON.stringify(result.results[0].result[0].address[0].latitude[0]));
                    console.log("longitude "+JSON.stringify(result.results[0].result[0].address[0].longitude[0]));

                    var marker = new google.maps.Marker({
                        map: map,
                        position: new google.maps.LatLng(latitude, longitude),
                        animation: google.maps.Animation.DROP,
                        icon: houseIcon
                    });

/*

                    var bathrooms = JSON.stringify(result.results[0].result[0].bathrooms);
                    var bedrooms = JSON.stringify(result.results[0].result[0].bedrooms);
                    console.log("this: "+bedrooms )


                    var zestimate = "$"+JSON.stringify(result.results[0].result[0].zestimate[0].amount[0]._);
                    var lastSoldPrice = "$"+JSON.stringify(result.results[0].result[0].lastSoldPrice[0]._);
*/
                    var addressText = '<h3 id="firstHeading" class="firstHeading">'+
                            result.results[0].result[0].address[0].street[0]+' '+result.results[0].result[0].address[0].city[0]+'</h3>';
                    var streetUrl = "https://maps.googleapis.com/maps/api/streetview?size=200x200&location="+latitude+","+longitude+"&fov=90&heading=235&pitch=10";
                    var streetViewImage = '<img src='+streetUrl+' alt="Street View" height="200" width="100%">';

                    var contentString = '<div id="content">' +
                            streetViewImage+
                            '<div id="siteNotice">'+
                            '</div>'+
                            addressText+
                            //'<h1 id="firstHeading" class="firstHeading">Uluru</h1>'+
                            '<div id="bodyContent">'+
                            '<p>' +
                            '<b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large ' +
                            'sandstone rock formation in the southern part of the '+
                            'Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) '+

                            'Heritage Site.</p>'+
                            '<p>Attribution: Uluru, <a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
                            'https://en.wikipedia.org/w/index.php?title=Uluru</a> '+
                            '(last visited June 22, 2009).</p>'+
                            '<button onclick="getZillowComps(16834453)">Get Comps</button>'+
                            '</div>'+
                            '</div>';

                    var houseInfowindow = new google.maps.InfoWindow({
                        content: contentString,
                        maxWidth: 400
                    });

                    google.maps.event.addListener(marker, 'click', function() {
                        houseInfowindow.open(map, this);
                    });
                },
                error: function(jqXHR, textstatus, errorThrown) {
                    //alert('text status ' + textstatus + ', err ' + errorThrown);
                }
            });
        };


        function getZillowComps(zpid) {
            console.log("trying to get comps: "+zpid);

            $.ajax({
                type: "GET",
                url: '/getCompResults',
                data: { zpid: zpid
                },
                success: function(result) {
                    console.log("comps Success: "+result) //Returned data from call

                },
                error: function(jqXHR, textstatus, errorThrown) {
                    alert('text status ' + textstatus + ', err ' + errorThrown);
                }
            });

        };


        function showMedianBounds() {

            //var year = 2012;
            //var listOfResults = [];
            $.ajax({
                type: "GET",
                url: '/readMedianData',
                success: function(result) {
                    console.log("median results: "+JSON.stringify(result[0]));
                    var regionHash = {};
                    var regionObject = {
                        zipCode: '',
                        years: []
                    };


                    for (var a in result) {
                        if(a%10 == 0){
                            regionHash[regionObject.zipCode] = regionObject;
                            regionObject = {
                                zipCode: '',
                                years: []
                            };
                            regionObject.zipCode = result[a].RegionName;
                            regionObject.years[a%10] = result[a].Value;
                        }

                        //if(!(result[a].RegionName in zipHash)){
                        regionObject.years[a%10] = result[a].Value;
                        console.log("regonName : " + JSON.stringify(regionObject.years));

                        //console.log("value : " + (1 - ((result[a].Value - 135) / 580)));
                    }

                    //var zA = [[92037, 0.2], [92121, 0.5], [92122, 0.8]];
                    colorRegions(regionHash);
                    //1 - ((value - 135) / 580)
                },
                error: function (jqXHR, textstatus, errorThrown) {
                    alert('text status ' + textstatus + ', err ' + errorThrown);
                }
            });

        };




/*

        function colorZips(zipArr) {

            var stlCollection = function(zips) {
                var stl = [{
                    polygonOptions: {
                        fillColor: '#00FF00',
                        fillOpacity: 0.3
                    }
                }];
                for(var i = 0; i < zipArr.length; i++) {
                    stl.push({
                        where: 'name = ' + zips[i][0],
                        polygonOptions: {
                            fillColor: '#03A9F4'//overColor(zips[i][1])
                        }
                    });
                }
                return stl;
            };
            layer.set('styles', stlCollection(zipArr));
        }

*/



        //zips should be in array format [ [zipcode, priceRating], [zipcode, priceRating], ... ]
        function colorRegions(zipHash) {

            layer = new google.maps.FusionTablesLayer({
                query: {
                    select: 'geometry',
                    from: '1Lae-86jeUDLmA6-8APDDqazlTOy1GsTXh28DAkw'
                },
                styles: [{
                    polygonOptions: {
                        fillColor: '#00FF00',
                        fillOpacity: 0.3
                    }
                }, {
                    where: 'zip2 in zipHash',
                    polygonOptions: {
                        fillColor: '#ffffff'
                    }
                }, {
                    where: 'zip2 = 92056',
                    polygonOptions: {
                        fillOpacity: 1.0,
                        fillColor: '#000000'
                    }

                }]
            });

            layer.setMap(map);
            //layer.set('styles', styleCollection(zipArr));
        }


        /** TODO Does not work, V3 throws errors when trying to save
         */
         function savePlaceInfo(place) {
            console.log("trying to save: "+place);

            $.ajax({
                type: "GET",
                url: '/saveResults',
                data: { data: place
                        },
                success: function(result) {
                    console.log("Save Success: "+result) //Returned data from call

                },
                error: function(jqXHR, textstatus, errorThrown) {
                    alert('text status ' + textstatus + ', err ' + errorThrown);
                }
            });

        };


        function callDatabase(){

            $.ajax({
                type: "GET",
                url: '/delphidata',
                data: { data: "test"
                },
                success: function(result) {

                    console.log("call Success: "+result) //Returned data from call

                },
                error: function(jqXHR, textstatus, errorThrown) {
                    //alert('text status ' + textstatus + ', err ' + errorThrown);
                    console.log("call error: ")
                }
            });


        }



        function getMedianValues(){

            $.ajax({
                type: "GET",
                url: '/readMedianData',
                success: function(result) {
                    console.log("MedianInfo: "+JSON.stringify(result));
                    //for (var a in result.features) {
                    //    buildBox(result.features[a].geometry.coordinates[0][0]);
                    //}
                },
                error: function(jqXHR, textstatus, errorThrown) {
                    //alert('text status ' + textstatus + ', err ' + errorThrown);
                    console.log("call error: ")


                }
            });
        }


        /**
         * C3 visualization for Marital status in SD
         */
        function getMaritalStatus(){

            $.ajax({
                type: "GET",
                url: '/readMaritalStatus',
                success: function(result) {
                    console.log("readMaritalStatus: "+JSON.stringify(result));
                    //for (var a in result.features) {
                    //    buildBox(result.features[a].geometry.coordinates[0][0]);
                    //}
                },
                error: function(jqXHR, textstatus, errorThrown) {
                    //alert('text status ' + textstatus + ', err ' + errorThrown);
                    console.log("call error: ")

                }
            });
        }


        //Not very useful boundaries
        function setupMapRegions(){

            $.ajax({
                type: "GET",
                url: '/showMapRegions',
                success: function(result) {
                    for (var a in result.features) {
                        buildBox(result.features[a].geometry.coordinates[0][0]);
                    }
                },
                error: function(jqXHR, textstatus, errorThrown) {
                    //alert('text status ' + textstatus + ', err ' + errorThrown);
                    console.log("call error: ")


                }
            });
        }

        function buildBox(coordinates){
            var regionBounds = [];
            for (var a in coordinates) {
                //console.log("Long: "+coordinates[a][0]);
                //console.log("Lat: "+coordinates[a][1]);
                regionBounds.push(new google.maps.LatLng(coordinates[a][1], coordinates[a][0]))
            }

            var regionPath = new google.maps.Polyline({
                path: regionBounds,
                geodesic: false,
                strokeColor: '#FF5722',
                strokeOpacity: 1.0,
                strokeWeight: 2
            });

            regionPath.setMap(map);
        }


        function hideRangeCircles(){
            rangeShowing = false;

            largeCircle.setMap(null);
            medCircle.setMap(null);
            smallCircle.setMap(null);
        }

        function showRangeCircles(location){


            rangeShowing = true;

            //var circle = new google.maps.Circle({radius: 10, center: map.getCenter()});
            //map.fitBounds(circle.getBounds());

            var city = citymap.sandiego1;

            var largeOptions = {
                strokeColor: '#03A9F4',
                strokeOpacity: 0.18,
                strokeWeight: 2,
                fillColor: '#03A9F4',
                fillOpacity: 0.2,
                map: map,
                center: new google.maps.LatLng(location.latitude, location.longitude)
                //radius: (1609.34)*1 //in meters
            };

            var medOptions = {
                strokeColor: '#03A9F4',
                strokeOpacity: 0.18,
                strokeWeight: 2,
                fillColor: '#03A9F4',
                fillOpacity: 0.1,
                map: map,
                center: map.getCenter() //city.center,
                //radius: (1609.34)*.5 //in meters
            };

            var smallOptions = {
                strokeColor: '#03A9F4',
                strokeOpacity: 0.18,
                strokeWeight: 2,
                fillColor: '#03A9F4',
                fillOpacity: 0.09,
                map: map,
                center: map.getCenter() //city.center,
                //radius: (1609.34)*.25 //.5 mile
            };




            // Add the circle for this city to the map.
            largeCircle = new google.maps.Circle(largeOptions);
            medCircle = new google.maps.Circle(medOptions);
            smallCircle = new google.maps.Circle(smallOptions);


            startAnimateCircles();


        }



        var smallRadius = 1;
        var mediumRadius = 1;
        var largeRadius = 1;
        var smallTime = 0;
        var mediumTime = 0;
        var largeTime = 0;

        var largeCircleInterval;
        var mediumCircleInterval;
        var smallCircleInterval;




        function smallCircleAnimation() {

            if ((smallRadius < smallCircleRadius)) {
                smallRadius =  -(1-(Math.pow((1-smallTime), 2)));
                smallCircle.setRadius(smallRadius);
            }
            else{
                clearInterval(smallCircleAnimation);
            }
            smallTime = smallTime += 5;
        }

        function medCircleAnimation() {

            if ((mediumRadius < medCircleRadius)) {
                mediumRadius =  -(1-(Math.pow((1-mediumTime), 2)));
                medCircle.setRadius(mediumRadius);
            }
            else{
                clearInterval(medCircleAnimation);
            }
            mediumTime = mediumTime += 3;
        }

        function largeCircleAnimation() {
            if ((largeRadius < largeCircleRadius)) {
                largeRadius =  -(1-(Math.pow((1-largeTime), 2)));
                largeCircle.setRadius(largeRadius);
            }
            else{
                clearInterval(largeCircleInterval);
            }
            largeTime = largeTime += 1;

        }




        function startAnimateCircles(){
            smallRadius = 1;
            mediumRadius = 1;
            largeRadius = 1;
            smallTime = 0;
            mediumTime = 0;
            largeTime = 0;

            largeCircleInterval = setInterval(largeCircleAnimation, 5);
            mediumCircleInterval = setInterval(medCircleAnimation, 3);
            smallCircleInterval = setInterval(smallCircleAnimation, 1);
        }




        function toggleMusic(){
            //console.log("toggle music:"+playSound);
            if(playSound){
                daySound.pause();
                nightSound.pause();
                playSound = false;
            }else{
                daySound.play();
                nightSound.play()
                playSound = true;
            }
        }


        function handleNoGeolocation(errorFlag) {
            if (errorFlag) {
                var content = 'Error: The Geolocation service failed.';
            } else {
                var content = 'Error: Your browser doesn\'t support geolocation.';
            }

            var options = {
                map: map,
                position: new google.maps.LatLng(60, 105),
                content: content
            };

            var infowindow = new google.maps.InfoWindow(options);
            map.setCenter(options.position);
        }


    </script>
    <style type="text/css">
        html, body {
            margin-left: 0px;
            margin-right: 0px;
            margin-top:0px;
            height: 100%;
            width: 100%;
        }
    </style>
</head>

<body>
<div id="locationField">
    <input id="autocomplete" placeholder="Enter your address"
           onFocus="geolocate()" type="text"/>
</div>


<div id="googleMap" style="width:90%;height:80%">

</div>


<style type="text/css">
    #googleMap {
        margin-left: 80px;
        margin-top: 80px;
        margin-bottom: 40px;
        position: relative;

    }

</style>

<button onclick="callDatabase()">Delphi</button>
<button onclick="toggleBoundingCircle()">Toggle circle bound</button>
<button onclick="getZillowComps(16834453)">Get Comps</button>
<button onclick="showMedianBounds()">Toggle Median Bounds</button>


<!-- About Section -->
<section id="about">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2 class="section-heading">More Info</h2>
                <h3 class="section-subheading text-muted">See what's going on in San Diego</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <ul class="timeline">
                    <li>
                        <div id="traffic_chart"></div>
                        <div class="timeline-image">
                            <img class="img-circle img-responsive" src="img/about/1.jpg" alt="">
                        </div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>Daytime</h4>
                                <h4 class="subheading">The busy city</h4>
                            </div>
                            <div class="timeline-body">
                                <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sunt ut voluptatum eius sapiente, totam reiciendis temporibus qui quibusdam, recusandae sit vero unde, sed, incidunt et ea quo dolore laudantium consectetur!</p>
                            </div>
                        </div>
                    </li>


                    <li class="timeline-inverted">
                        <div id="marital_chart"></div>
                        <div class="timeline-image">
                            <img class="img-circle img-responsive" src="img/about/4.jpg" alt="">
                        </div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>Nightlife</h4>
                                <h4 class="subheading">The happy hours</h4>
                            </div>
                            <div class="timeline-body">

                                <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Sunt ut voluptatum eius sapiente, totam reiciendis temporibus qui quibusdam, recusandae sit vero unde, sed, incidunt et ea quo dolore laudantium consectetur!</p>
                            </div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image">
                            <h4>Be Part
                                <br>Of Our
                                <br>Story!</h4>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>

<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <span class="copyright">Copyright &copy; Bachelor's Pad</span>
            </div>
            <div class="col-md-4">
                <ul class="list-inline social-buttons">
                    <li><a href="#"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li><a href="#"><i class="fa fa-facebook"></i></a>
                    </li>
                    <li><a href="#"><i class="fa fa-linkedin"></i></a>
                    </li>
                </ul>
            </div>
            <div class="col-md-4">
                <ul class="list-inline quicklinks">
                    <li><a href="#">Designed by Shuangli Zhou</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>


<script>

    var chart = c3.generate({
        bindto: '#traffic_chart',
        data: {
            columns: [
                ['data1', 30, 200, 100, 400, 150, 250],
                ['data2', 130, 100, 140, 200, 150, 50]
            ],
            type: 'spline'
        }
    });



/* //TODO traffic stats
    $.ajax({
        type: "GET",
        url: '/readTrafficStatus',
        success: function(result) {

            var test = [50, 20, 10, 40, 15, 2555];
            console.log("marital result: "+JSON.stringify(result.data[0]));
            console.log("marital result: "+JSON.stringify(result.data[0][11]));

            var locations = result.data.map(function (item) {
                return item[9];
            });

            var totalPopulation = result.data.map(function (item) {
                return item[11];
            });

            var singleStats = result.data.map(function (item) {
                return item[12];
            });

            var marriedStats = result.data.map(function (item) {
                return item[13];
            });

            var separatedStats = result.data.map(function (item) {
                return item[14];
            });

            var widowedStats = result.data.map(function (item) {
                return item[15];
            });

            var divorcedStats = result.data.map(function (item) {
                return item[16];
            });


            var chart = c3.generate({
                bindto: '#marital_chart',
                data: {
                    x : 'x',
                    json: {
                        x : locations,
                        Single: singleStats,
                        Married: marriedStats,
                        Separated: separatedStats,
                        Widowed: widowedStats,
                        Divorced: divorcedStats
                    },
                    groups: [
                        ['Single', 'Widowed']
                    ],
                    types: {
                        Single: 'area-spline',
                        Married: 'bar'
                    }
                },
                axis: {
                    x: {
                        type: 'category',
                        tick: {
                            rotate: 75,
                            multiline: false
                        },
                        height: 100
                    }
                }
            });



        },
        error: function(jqXHR, textstatus, errorThrown) {
            //alert('text status ' + textstatus + ', err ' + errorThrown);
            console.log("call error: ")

        }
    });
*/


    //  totalPop, single, married, separated, widowed, divorced

    $.ajax({
        type: "GET",
        url: '/readMaritalStatus',
        success: function(result) {

            var test = [50, 20, 10, 40, 15, 2555];
            console.log("marital result: "+JSON.stringify(result.data[0]));
            console.log("marital result: "+JSON.stringify(result.data[0][11]));

            var locations = result.data.map(function (item) {
                return item[9];
            });

            var totalPopulation = result.data.map(function (item) {
                return item[11];
            });

            var singleStats = result.data.map(function (item) {
                return item[12];
            });

            var marriedStats = result.data.map(function (item) {
                return item[13];
            });

            var separatedStats = result.data.map(function (item) {
                return item[14];
            });

            var widowedStats = result.data.map(function (item) {
                return item[15];
            });

            var divorcedStats = result.data.map(function (item) {
                return item[16];
            });


            var chart = c3.generate({
                bindto: '#marital_chart',
                data: {
                    x : 'x',
                    json: {
                        x : locations,
                        Single: singleStats,
                        Married: marriedStats,
                        Separated: separatedStats,
                        Widowed: widowedStats,
                        Divorced: divorcedStats
                    },
                    groups: [
                        ['Single', 'Widowed']
                    ],
                    types: {
                        Single: 'area-spline',
                        Married: 'bar'
                    }
                },
                axis: {
                    x: {
                        type: 'category',
                        tick: {
                            rotate: 75,
                            multiline: false
                        },
                        height: 100
                    }
                }
            });



        },
        error: function(jqXHR, textstatus, errorThrown) {
            //alert('text status ' + textstatus + ', err ' + errorThrown);
            console.log("call error: ")


        }
    });



</script>
</body>
</html>